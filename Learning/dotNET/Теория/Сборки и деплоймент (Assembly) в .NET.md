Сборки (Assemblies) являются ключевым компонентом платформы .NET. Они представляют собой единицу развертывания, управления версиями и безопасности в приложениях .NET. Сборки могут содержать исполняемый код (IL - Intermediate Language), метаданные, ресурсы (например, изображения), а также управлять зависимостями между модулями.

---

#### **1. Что такое сборка (Assembly)?**

Сборка — это физический файл, который может быть либо библиотекой (DLL), либо исполняемым файлом (EXE). Это основной элемент, необходимый для выполнения приложений .NET. Она объединяет код и метаданные, необходимые для выполнения и описания приложения.

---

#### **2. Два типа сборок: DLL и EXE**

- **DLL (Dynamic Link Library):**
    
    - Содержит библиотеку функций и процедур, которые могут быть использованы в других программах.
    - Не является самостоятельным исполняемым файлом, его нужно вызывать из других приложений.
    - Примеры: вспомогательные классы, утилиты, обработчики логики.
- **EXE (Executable):**
    
    - Исполняемый файл, который запускает приложение.
    - Является точкой входа программы, содержащей метод `Main`.
    - Пример: консольные или графические приложения.

---

#### **3. Глобальный кэш сборок (Global Assembly Cache, GAC)**

**GAC** — это централизованное хранилище для сборок, которые могут быть использованы несколькими приложениями на одном компьютере. GAC используется для обеспечения совместного использования сборок между различными приложениями.

##### **Особенности GAC:**

1. **Работает только с подписанными сборками (strong-named assemblies):**
    - Для добавления сборки в GAC требуется уникальная подпись (strong name), которая включает в себя имя сборки, номер версии, язык и ключ шифрования.
2. **Расположение:**
    - Находится на системном диске (обычно `C:`) в каталоге:
        
        ```
        C:\Windows\Microsoft.NET\assembly   (for .Net 4.0)
        and
        C:\Windows\assembly   (for .Net 2.0-3.5)
        ```
        

---

#### **4. Регистрация сборок**

Чтобы сборка была доступна для использования, её необходимо зарегистрировать. Процесс регистрации отличается для GAC и локального использования.

##### **Этапы регистрации сборки в GAC:**

1. **Создание подписи для сборки (Strong Name):**
    
    - Используется инструмент `sn.exe`:
        
        ```
        sn -k ключ.snk
        ```
        
    - Добавление подписи в проект через Visual Studio.
2. **Компиляция сборки:**
    
    - Генерация сборки в формате DLL или EXE.
3. **Добавление сборки в GAC:**
    
    - Используется утилита `gacutil.exe`:
        
        ```
        gacutil -i имя_сборки.dll
        ```
        
    - Или перемещение вручную в каталог GAC.

---

#### **5. Несколько подходов к развертыванию приложений**

1. **Локальное развертывание (Private Deployment):**
    
    - Сборка копируется в папку приложения.
    - Подходит для простых приложений, когда зависимости уникальны.
2. **Развертывание через GAC (Shared Deployment):**
    
    - Используется для общих библиотек, которые могут быть разделяемыми между приложениями.
3. **Развертывание ClickOnce:**
    
    - Автоматизированный механизм установки и обновления приложений.
    - Прост в использовании, подходит для небольших приложений.
4. **Развертывание через контейнеры или облачные платформы:**
    
    - Используется в современных DevOps-средах.
    - Примеры: Docker, Kubernetes, Azure, AWS.

---

### Часто задаваемые вопросы и ответы

#### **1. Что такое сборка (Assembly) в .NET?**

**Ответ:**  
Сборка — это основная единица развертывания, безопасности и управления версиями в .NET. Она представляет собой файл, который может содержать исполняемый код (IL), метаданные и ресурсы. Сборки бывают двух типов: DLL (библиотека) и EXE (исполняемый файл).

---

#### **2. Чем отличается DLL от EXE?**

**Ответ:**

- **DLL (Dynamic Link Library):**  
    Это библиотека, которая не может выполняться самостоятельно и используется для предоставления функциональности другим приложениям.
- **EXE (Executable):**  
    Это исполняемый файл, содержащий точку входа (метод `Main`), который запускает приложение.

---

#### **3. Что такое глобальный кэш сборок (Global Assembly Cache, GAC)?**

**Ответ:**  
GAC — это централизованное хранилище для сборок, которые могут быть использованы несколькими приложениями на одном компьютере. Сборки в GAC должны иметь уникальную подпись (strong name) для предотвращения конфликтов версий.

---

#### **4. Какие преимущества использования GAC?**

**Ответ:**

- Возможность совместного использования сборок между разными приложениями.
- Централизованное управление версиями.
- Снижение дублирования библиотек на диске.

---

#### **5. Какие шаги необходимо выполнить для регистрации сборки в GAC?**

**Ответ:**

1. Создать strong name для сборки с помощью `sn.exe`.
2. Подписать сборку этим именем.
3. Скомпилировать сборку.
4. Зарегистрировать сборку в GAC с помощью команды:
    
    ```
    gacutil -i имя_сборки.dll
    ```
    

---

#### **6. Как найти зарегистрированную сборку в GAC?**

**Ответ:**  
Сборки находятся в папке:

```
C:\Windows\Microsoft.NET\assembly
```

Также можно использовать команду:

```
gacutil -l
```

для отображения всех зарегистрированных сборок.

---

#### **7. Что такое strong name? Зачем он нужен?**

**Ответ:**  
Strong name — это уникальная подпись сборки, которая создаётся с использованием криптографического ключа. Она обеспечивает:

- Уникальность сборки.
- Защиту от подмены или случайного конфликта версий.
- Совместимость с GAC.

---

#### **8. Какие виды развертывания приложений доступны в .NET?**

**Ответ:**

1. **Локальное развертывание (Private Deployment):** Сборки размещаются в папке приложения.
2. **Развертывание через GAC:** Используется для общих библиотек.
3. **ClickOnce:** Автоматизированное развертывание и обновление.
4. **Облачное развертывание:** Используется контейнеризация (Docker) или облачные платформы (Azure, AWS).

---

#### **9. Какие данные содержатся в метаданных сборки?**

**Ответ:**  
Метаданные включают:

- Информацию о типах (классы, интерфейсы, структуры).
- Информацию о версиях сборки.
- Данные о strong name (при наличии).
- Зависимости от других сборок.

---

#### **10. Что такое манифест сборки?**

**Ответ:**  
Манифест сборки — это часть метаданных, которая содержит информацию:

- О версии сборки.
- О зависимостях.
- Список файлов сборки.
- О сильной подписи (strong name, если есть).  
    Он обеспечивает правильную загрузку сборки во время выполнения.

---

#### **11. Что произойдёт, если в приложении отсутствует нужная сборка?**

**Ответ:**  
Если сборка отсутствует или версия несовместима, приложение выбросит исключение `FileNotFoundException` или `FileLoadException`. Это может быть связано с тем, что сборка:

- Не установлена в GAC.
- Отсутствует в папке приложения.
- Подписана другим ключом.

---

#### **12. Как обеспечить совместимость между разными версиями сборки?**

**Ответ:**

- Использовать настройку перенаправления версий (Binding Redirect) в файле `app.config` или `web.config`.
- Пример:
    
    ```xml
    <configuration>
      <runtime>
        <assemblyBinding xmlns="urn:schemas-microsoft-com:asm.v1">
          <dependentAssembly>
            <assemblyIdentity name="MyLibrary" publicKeyToken="1234567890abcdef" culture="neutral" />
            <bindingRedirect oldVersion="1.0.0.0-1.9.9.9" newVersion="2.0.0.0" />
          </dependentAssembly>
        </assemblyBinding>
      </runtime>
    </configuration>
    ```
    

---

#### **13. Чем отличается развертывание сборок в .NET Framework и .NET Core?**

**Ответ:**

- В **.NET Framework** активно используется GAC для общих сборок.
- В **.NET Core** и **.NET 5+** GAC не используется, так как каждая программа содержит свои зависимости (Self-Contained Deployment). Это делает приложения более независимыми и переносимыми.

---

#### **14. Как работает сборка с зависимостями?**

**Ответ:**  
При загрузке приложения CLR ищет зависимые сборки:

1. В папке приложения.
2. В GAC (если зависимость подписана).
3. По путям, указанным в файле `app.config` (например, `probing paths`).

---

#### **15. Что такое Shadow Copy и зачем оно нужно?**

**Ответ:**  
Shadow Copy — это механизм, позволяющий загружать сборки в память без блокировки исходного файла на диске. Это полезно для обновления приложения без его остановки, например, в ASP.NET.

---

#### **16. Чем отличается статическая и динамическая загрузка сборок?**

**Ответ:**

- **Статическая загрузка:**  
    Сборка подключается на этапе компиляции через директиву `using` или ссылку в проекте.
- **Динамическая загрузка:**  
    Сборка загружается в рантайме с использованием `Assembly.Load` или `Assembly.LoadFrom`.

---

#### **17. Как загрузить сборку в рантайме?**

**Ответ:**  
С помощью класса `System.Reflection.Assembly`.  
Пример:

```csharp
Assembly assembly = Assembly.LoadFrom("MyLibrary.dll");
Type type = assembly.GetType("MyLibrary.MyClass");
object instance = Activator.CreateInstance(type);
```

---

#### **18. Что такое сборка с задержанной привязкой (Delay-Signed Assembly)?**

**Ответ:**  
Это сборка, которая подписана не полностью, а только временно с использованием публичного ключа. Такой подход используется на этапе разработки, чтобы избежать хранения приватного ключа в коде. Полная подпись выполняется на этапе сборки релиза.

---

#### **19. Как проверить, подписана ли сборка strong name?**

**Ответ:**  
Использовать утилиту `sn.exe` с параметром `-v`:

```bash
sn -v MyLibrary.dll
```

---

#### **20. Как управлять версиями сборок?**

**Ответ:**  
Версия указывается в атрибуте `[AssemblyVersion]` в файле `AssemblyInfo.cs` или в `.csproj`.  
Пример:

```csharp
[assembly: AssemblyVersion("1.0.0.0")]
[assembly: AssemblyFileVersion("1.0.0.0")]
```

- **AssemblyVersion:** Указывает версию API. Изменение ломает совместимость.
- **AssemblyFileVersion:** Указывает номер сборки. Используется для внутренних целей.

---

#### **21. Что такое саттелитная сборка (Satellite Assembly)?**

**Ответ:**  
Саттелитная сборка содержит ресурсы для локализации (например, строки, изображения). Она отделяется от основной сборки и загружается в зависимости от культуры.  
Пример: `MyApp.resources.dll` для локализации на определённый язык.

---

#### **22. Как работает манифест развертывания ClickOnce?**

**Ответ:**  
ClickOnce создаёт два манифеста:

1. **Манифест приложения:** Описывает файл приложения, зависимости и их версии.
2. **Манифест развертывания:** Указывает, где искать обновления, и параметры установки.  
    Оба манифеста хранятся в виде XML.

---

#### **23. Как работает механизм Binding Redirect?**

**Ответ:**  
Binding Redirect позволяет перенаправлять использование устаревшей версии сборки на новую. Это конфигурируется в файле `app.config` или `web.config` с использованием элемента `assemblyBinding`.

---

#### **24. Какое расположение сборки предпочтительнее: GAC или локальная папка?**

**Ответ:**

- **GAC:** Подходит для общих библиотек, которые разделяются между несколькими приложениями.
- **Локальная папка:** Предпочтительна для независимых приложений, чтобы избежать конфликтов версий.

---

#### **25. Что такое "Self-Contained Deployment" и "Framework-Dependent Deployment" в .NET Core?**

**Ответ:**

- **Self-Contained Deployment (SCD):** Приложение включает в себя все зависимости, включая .NET Runtime, и может выполняться независимо от установленной версии .NET.
- **Framework-Dependent Deployment (FDD):** Приложение полагается на установленную версию .NET Runtime на целевой машине.

---

#### **26. Как работает кроссплатформенное развертывание в .NET Core?**

**Ответ:**  
Кроссплатформенное развертывание достигается благодаря `RID` (Runtime Identifier). При публикации можно указать конкретную платформу:

```bash
dotnet publish -r win-x64
dotnet publish -r linux-x64
```

---

#### **27. Что такое "Assembly Load Context" в .NET Core?**

**Ответ:**  
Assembly Load Context — это механизм, позволяющий изолированно загружать сборки в .NET Core. Это полезно для сценариев, где разные версии библиотек должны сосуществовать.

---

#### **28. Как защитить сборку от декомпиляции?**

**Ответ:**  
Использовать обфускаторы, такие как Dotfuscator или ConfuserEx, чтобы усложнить чтение исходного кода при декомпиляции.

---

#### **29. Что такое ILMerge?**

**Ответ:**  
ILMerge — это утилита, позволяющая объединять несколько сборок в одну. Это полезно для упрощения развертывания.  
Пример команды:

```bash
ILMerge /out:CombinedLibrary.dll Library1.dll Library2.dll
```

---

#### **30. Как удалить сборку из GAC?**

**Ответ:**  
С помощью команды:

```bash
gacutil -u имя_сборки
```

Или вручную, удалив файл из папки GAC.

---

#### **31. Что такое "Runtime Configuration File" в .NET Core?**

**Ответ:**  
Это файл `runtimeconfig.json`, который создаётся при публикации приложения. Он указывает информацию о версии .NET, используемой приложением, и зависимостях.

---

#### **32. Как работает "Side-by-Side Execution" в .NET?**

**Ответ:**  
Это возможность запускать приложения, использующие разные версии .NET, на одной машине. В .NET Framework это достигается через GAC, а в .NET Core и выше — через изолированные среды.

---

#### **33. Как добавить зависимость в проект без использования GAC?**

**Ответ:**  
Можно использовать NuGet-пакеты или локальную копию библиотеки, добавив её в проект как ссылку.

---

#### **34. Как проверить версии установленных сборок .NET Framework?**

**Ответ:**  
Через команду PowerShell:

```powershell
Get-ChildItem 'HKLM:\SOFTWARE\Microsoft\NET Framework Setup\NDP'
```

---

#### **35. Какое поведение сборки, если версия .NET на целевой машине ниже требуемой?**

**Ответ:**  
Приложение не запустится, и будет выброшено исключение о несовместимости версии.

---

#### **36. Какие инструменты используются для анализа сборок?**

**Ответ:**

- **ILSpy:** Для декомпиляции IL-кода.
- **dotPeek:** Бесплатный декомпилятор от JetBrains.
- **Reflector:** Коммерческий инструмент для анализа сборок.
- **dnSpy:** Инструмент для изучения и отладки сборок.

---
