–ü–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (thread safety) –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –æ–±—ä–µ–∫—Ç –∏–ª–∏ –º–µ—Ç–æ–¥ –º–æ–≥—É—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å –≤ –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ–π —Å—Ä–µ–¥–µ –±–µ–∑ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º (–≥–æ–Ω–∫–∏ –ø–æ—Ç–æ–∫–æ–≤, –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö, deadlock'–æ–≤ –∏ —Ç. –¥.).

---

## **1. –ü–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω—ã –ª–∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏?**

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é **`List<T>` –∏ `Dictionary<TKey, TValue>` –Ω–µ —è–≤–ª—è—é—Ç—Å—è –ø–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω—ã–º–∏**.  
–ï—Å–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ—Ç–æ–∫–æ–≤ –∏–∑–º–µ–Ω—è—é—Ç `List<T>`, –º–æ–≥—É—Ç –≤–æ–∑–Ω–∏–∫–Ω—É—Ç—å –∏—Å–∫–ª—é—á–µ–Ω–∏—è (`InvalidOperationException`).

**–ü—Ä–∏–º–µ—Ä –ø—Ä–æ–±–ª–µ–º—ã:**

```csharp
List<int> numbers = new();

Parallel.For(0, 1000, i =>
{
    numbers.Add(i);  // –ú–æ–∂–µ—Ç –≤—ã–±—Ä–æ—Å–∏—Ç—å –∏—Å–∫–ª—é—á–µ–Ω–∏–µ
});
```

–†–µ—à–µ–Ω–∏–µ: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **–ø–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏** (`ConcurrentDictionary`, `ConcurrentBag`, `ConcurrentQueue`).

---

## **2. –°–ø–æ—Å–æ–±—ã —Ä–µ—à–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º –ø–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏**

### **1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `lock`**

–ú–æ–∂–Ω–æ –∑–∞—â–∏—Ç–∏—Ç—å –∫–æ–ª–ª–µ–∫—Ü–∏—é —Å –ø–æ–º–æ—â—å—é `lock`, –Ω–æ —ç—Ç–æ —Å–Ω–∏–∂–∞–µ—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:

```csharp
private static readonly object _lock = new();
private static List<int> numbers = new();

public static void AddNumber(int number)
{
    lock (_lock)
    {
        numbers.Add(number);
    }
}
```

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**

- `lock` –±–ª–æ–∫–∏—Ä—É–µ—Ç –≤–µ—Å—å –¥–æ—Å—Ç—É–ø –∫ —Ä–µ—Å—É—Ä—Å—É, —Å–Ω–∏–∂–∞—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ—Å—Ç—å.
- –ú–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ deadlock'—É –ø—Ä–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏.

---

### **2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `ConcurrentDictionary`**

`ConcurrentDictionary` –ø–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–µ–Ω –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∞—Ç–æ–º–∞—Ä–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏.

```csharp
ConcurrentDictionary<int, string> dict = new();

Parallel.For(0, 1000, i =>
{
    dict.TryAdd(i, $"Value {i}");
});
```

**–ü–ª—é—Å—ã:**  
‚úÖ –ü–æ–∑–≤–æ–ª—è–µ—Ç —á–∏—Ç–∞—Ç—å –∏ –∏–∑–º–µ–Ω—è—Ç—å –¥–∞–Ω–Ω—ã–µ –±–µ–∑ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –≤—Å–µ–π –∫–æ–ª–ª–µ–∫—Ü–∏–∏.  
‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∞—Ç–æ–º–∞—Ä–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (`TryAdd`, `TryRemove`, `TryUpdate`).  
‚úÖ –í—ã—Å–æ–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å `lock`.

---

### **3. –î—Ä—É–≥–∏–µ `Concurrent`-–∫–æ–ª–ª–µ–∫—Ü–∏–∏**

#### **`ConcurrentBag<T>` (–Ω–µ—É–ø–æ—Ä—è–¥–æ—á–µ–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ)**

```csharp
ConcurrentBag<int> bag = new();

Parallel.For(0, 1000, i =>
{
    bag.Add(i);
});
```

‚úÖ –ë—ã—Å—Ç—Ä–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤.  
‚ùå –ù–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —É–ø–æ—Ä—è–¥–æ—á–µ–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø.

#### **`ConcurrentQueue<T>` (–æ—á–µ—Ä–µ–¥—å FIFO)**

```csharp
ConcurrentQueue<int> queue = new();
queue.Enqueue(1);
queue.Enqueue(2);

if (queue.TryDequeue(out int result))
{
    Console.WriteLine(result);  // 1
}
```

‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ–π —Å—Ä–µ–¥–µ.

#### **`ConcurrentStack<T>` (—Å—Ç–µ–∫ LIFO)**

```csharp
ConcurrentStack<int> stack = new();
stack.Push(1);
stack.Push(2);

if (stack.TryPop(out int result))
{
    Console.WriteLine(result);  // 2
}
```

‚úÖ –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –∑–∞–¥–∞—á, –≥–¥–µ –≤–∞–∂–µ–Ω –ø–æ—Ä—è–¥–æ–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏ (LIFO).

---

## **3. `Semaphore` –∏ `SemaphoreSlim`**

`Semaphore` –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Ç–æ–∫–æ–≤, –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –≤—ã–ø–æ–ª–Ω—è—é—â–∏—Ö –∫–æ–¥.

### **–ü—Ä–æ—Å—Ç–æ–π –ø—Ä–∏–º–µ—Ä —Å `SemaphoreSlim`**

```csharp
SemaphoreSlim semaphore = new(2); // –ú–∞–∫—Å–∏–º—É–º 2 –ø–æ—Ç–æ–∫–∞ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ

async Task DoWorkAsync(int id)
{
    await semaphore.WaitAsync();  // –ñ–¥—ë–º, –µ—Å–ª–∏ –ª–∏–º–∏—Ç –ø—Ä–µ–≤—ã—à–µ–Ω
    try
    {
        Console.WriteLine($"–ü–æ—Ç–æ–∫ {id} –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Ä–∞–±–æ—Ç—É");
        await Task.Delay(1000);
    }
    finally
    {
        semaphore.Release();  // –û—Å–≤–æ–±–æ–∂–¥–∞–µ–º —Å–ª–æ—Ç
    }
}

async Task RunTasksAsync()
{
    List<Task> tasks = new();
    for (int i = 0; i < 5; i++)
    {
        tasks.Add(DoWorkAsync(i));
    }
    await Task.WhenAll(tasks);
}
```

‚úÖ –ü–æ–∑–≤–æ–ª—è–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π.  
‚úÖ `SemaphoreSlim` –±–æ–ª–µ–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–µ–Ω, —á–µ–º `Semaphore`, –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ `async/await`.

---

## **4. –†–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É `lock` –∏ `Monitor`**

### **1. `lock` (–ø—Ä–æ—Å—Ç–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è)**

`lock` ‚Äî —É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –æ–±–æ–ª–æ—á–∫–∞ –≤–æ–∫—Ä—É–≥ `Monitor.Enter/Exit`.

```csharp
private static readonly object _lock = new();

public void SafeMethod()
{
    lock (_lock)
    {
        Console.WriteLine("–ú–µ—Ç–æ–¥ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –±–µ–∑–æ–ø–∞—Å–Ω–æ.");
    }
}
```

**–ú–∏–Ω—É—Å—ã:**  
‚ùå –ï—Å–ª–∏ –ø–æ—Ç–æ–∫ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω, –æ–Ω –æ—Å—Ç–∞—ë—Ç—Å—è –≤ –æ–∂–∏–¥–∞–Ω–∏–∏ (–Ω–µ—Ç —Ç–∞–π–º–∞—É—Ç–∞).  
‚ùå –ú–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ deadlock'—É.

---

### **2. `Monitor` (–≥–∏–±–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è)**

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–∞ **–≥–∏–±–∫–æ—Å—Ç—å**, –Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–æ–≤–µ—Ä–∫–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ —Å —Ç–∞–π–º–∞—É—Ç–æ–º.

```csharp
if (Monitor.TryEnter(_lock, TimeSpan.FromSeconds(1)))
{
    try
    {
        Console.WriteLine("–ú–µ—Ç–æ–¥ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –±–µ–∑–æ–ø–∞—Å–Ω–æ.");
    }
    finally
    {
        Monitor.Exit(_lock);
    }
}
else
{
    Console.WriteLine("–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–∫—É.");
}
```

‚úÖ –ü–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–¥–∞—Ç—å **—Ç–∞–π–º–∞—É—Ç** –æ–∂–∏–¥–∞–Ω–∏—è.  
‚úÖ –ú–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, –¥–æ—Å—Ç—É–ø–Ω–∞ –ª–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞.

---

## **–í—ã–≤–æ–¥**

- **–û–±—ã—á–Ω—ã–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ (`List<T>`, `Dictionary<TKey, TValue>`) –ù–ï –ø–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω—ã.**
- **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `Concurrent`-–∫–æ–ª–ª–µ–∫—Ü–∏–∏ (`ConcurrentDictionary`, `ConcurrentBag`, `ConcurrentQueue`).**
- **`SemaphoreSlim` –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø–æ—Ç–æ–∫–æ–≤.**
- **`lock` ‚Äî –ø—Ä–æ—Å—Ç–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞, `Monitor` –¥–∞—ë—Ç –±–æ–ª—å—à–µ –∫–æ–Ω—Ç—Ä–æ–ª—è.**

üéØ **–ü—Ä–∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–µ –∫ –∏–Ω—Ç–µ—Ä–≤—å—é –≤–∞–∂–Ω–æ –ø–æ–Ω–∏–º–∞—Ç—å:**  
‚úî –†–∞–∑–Ω–∏—Ü—É –º–µ–∂–¥—É `lock`, `Monitor`, `SemaphoreSlim`.  
‚úî –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `ConcurrentDictionary` –≤–º–µ—Å—Ç–æ –æ–±—ã—á–Ω–æ–≥–æ `Dictionary`.  
‚úî –ö–∞–∫ –∏–∑–±–µ–∂–∞—Ç—å Deadlock'–æ–≤ –ø—Ä–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–µ —Ä–µ—Å—É—Ä—Å–æ–≤.
