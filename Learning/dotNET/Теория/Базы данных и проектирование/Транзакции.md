## **1. –ß—Ç–æ —Ç–∞–∫–æ–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏?**

**–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è** ‚Äì —ç—Ç–æ –≥—Ä—É–ø–ø–∞ –æ–ø–µ—Ä–∞—Ü–∏–π —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä–∞—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è **–∫–∞–∫ –µ–¥–∏–Ω–æ–µ —Ü–µ–ª–æ–µ**. –ï—Å–ª–∏ –æ–¥–Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏—è –Ω–µ —É–¥–∞–ª–∞—Å—å, –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ—Ç–º–µ–Ω—è—é—Ç—Å—è (Rollback).

üìå **–ü—Ä–∏–º–µ—Ä –±–µ–∑ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (–ø—Ä–æ–±–ª–µ–º–∞)**  
–ï—Å–ª–∏ –≤ `Customers` –¥–æ–±–∞–≤–∏–ª–∏ –∫–ª–∏–µ–Ω—Ç–∞, –Ω–æ –≤ `Orders` –∑–∞–∫–∞–∑ –Ω–µ —Å–æ–∑–¥–∞–ª—Å—è, –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç **–Ω–µ–∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ã**.

üìå **–ü—Ä–∏–º–µ—Ä —Å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–µ–π (—Ä–µ—à–µ–Ω–∏–µ)**

```csharp
using (var connection = new SqlConnection(connectionString))  
{  
    connection.Open();  
    using (var transaction = connection.BeginTransaction())  
    {  
        try  
        {  
            var cmd1 = new SqlCommand("INSERT INTO Customers (Name) VALUES ('John')", connection, transaction);
            cmd1.ExecuteNonQuery();  
            
            var cmd2 = new SqlCommand("INSERT INTO Orders (CustomerId, Amount) VALUES (SCOPE_IDENTITY(), 100)", connection, transaction);
            cmd2.ExecuteNonQuery();  
            
            transaction.Commit();  // ‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é  
        }  
        catch  
        {  
            transaction.Rollback();  // ‚ùå –û—Ç–∫–∞—Ç—ã–≤–∞–µ–º –ø—Ä–∏ –æ—à–∏–±–∫–µ  
        }  
    }  
}
```

---

## **2. ACID ‚Äì –°–≤–æ–π—Å—Ç–≤–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏**

–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –¥–æ–ª–∂–Ω—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å **ACID**:

|–°–≤–æ–π—Å—Ç–≤–æ|–û–ø–∏—Å–∞–Ω–∏–µ|
|---|---|
|**–ê—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å (Atomicity)**|–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è **–ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–ª–∏ –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤–æ–≤—Å–µ**. –ï—Å–ª–∏ –æ–¥–Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏—è –Ω–µ —É–¥–∞–ª–∞—Å—å ‚Äì –æ—Ç–º–µ–Ω—è—é—Ç—Å—è –≤—Å–µ.|
|**–°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å (Consistency)**|–î–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—è—Ç **–∏–∑ –æ–¥–Ω–æ–≥–æ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤ –¥—Ä—É–≥–æ–µ**. –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –Ω–µ –¥–æ–ª–∂–Ω–∞ –æ—Å—Ç–∞–≤–∏—Ç—å –±–∞–∑—É –≤ –Ω–µ–∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏.|
|**–ò–∑–æ–ª—è—Ü–∏—è (Isolation)**|–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è **–Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –¥—Ä—É–≥–∏—Ö** (—Ä–∞–∑–Ω—ã–µ —É—Ä–æ–≤–Ω–∏ –∏–∑–æ–ª—è—Ü–∏–∏).|
|**–î–æ–ª–≥–æ–≤–µ—á–Ω–æ—Å—Ç—å (Durability)**|–ü–æ—Å–ª–µ `COMMIT`, –∏–∑–º–µ–Ω–µ–Ω–∏—è **—Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –Ω–∞–≤—Å–µ–≥–¥–∞** (–¥–∞–∂–µ –ø—Ä–∏ —Å–±–æ–µ —Å–∏—Å—Ç–µ–º—ã).|

---

## **3. [[–£—Ä–æ–≤–Ω–∏ –∏–∑–æ–ª—è—Ü–∏–∏ (Isolation Levels)]]**

–û–ø—Ä–µ–¥–µ–ª—è—é—Ç, –∫–∞–∫ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤–∏–¥—è—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥—Ä—É–≥–∏—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π.

| –£—Ä–æ–≤–µ–Ω—å              | –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç                            | –ü—Ä–æ–±–ª–µ–º—ã                                    |
| -------------------- | -------------------------------------- | ------------------------------------------- |
| **Read Uncommitted** | –ù–∏—á–µ–≥–æ                                 | "–ì—Ä—è–∑–Ω—ã–µ" (–Ω–µ—Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ) –¥–∞–Ω–Ω—ã–µ            |
| **Read Committed**   | –ù–µ—Ç –≥—Ä—è–∑–Ω–æ–≥–æ —á—Ç–µ–Ω–∏—è                    | –í–æ–∑–º–æ–∂–Ω—ã —Ñ–∞–Ω—Ç–æ–º–Ω—ã–µ –∏ –Ω–µ–ø–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è —á—Ç–µ–Ω–∏—è |
| **Repeatable Read**  | –ù–µ—Ç –≥—Ä—è–∑–Ω–æ–≥–æ –∏ –Ω–µ–ø–æ–≤—Ç–æ—Ä—è—é—â–µ–≥–æ—Å—è —á—Ç–µ–Ω–∏—è | –í–æ–∑–º–æ–∂–Ω—ã —Ñ–∞–Ω—Ç–æ–º–Ω—ã–µ —á—Ç–µ–Ω–∏—è                   |
| **Serializable**     | –ü–æ–ª–Ω–∞—è –∏–∑–æ–ª—è—Ü–∏—è                        | ‚ùå –ú–µ–¥–ª–µ–Ω–Ω—ã–π, –±–ª–æ–∫–∏—Ä—É–µ—Ç –¥—Ä—É–≥–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏    |

üìå **–ü—Ä–∏–º–µ—Ä —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —É—Ä–æ–≤–Ω—è –∏–∑–æ–ª—è—Ü–∏–∏:**

```sql
SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;
BEGIN TRANSACTION;
-- SQL-–∑–∞–ø—Ä–æ—Å—ã
COMMIT;
```

---

## **4. –ö–∞–∫ —Ä–∞–±–æ—Ç–∞—Ç—å —Å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏?**

### **ADO.NET (—Ä—É—á–Ω–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è)**

```csharp
using (var connection = new SqlConnection(connectionString))  
{  
    connection.Open();  
    SqlTransaction transaction = connection.BeginTransaction();  
    try  
    {  
        var command = new SqlCommand("UPDATE Accounts SET Balance = Balance - 100 WHERE Id = 1", connection, transaction);  
        command.ExecuteNonQuery();  
        
        command = new SqlCommand("UPDATE Accounts SET Balance = Balance + 100 WHERE Id = 2", connection, transaction);  
        command.ExecuteNonQuery();  
        
        transaction.Commit(); // ‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è  
    }  
    catch  
    {  
        transaction.Rollback(); // ‚ùå –û—Ç–∫–∞—Ç –ø—Ä–∏ –æ—à–∏–±–∫–µ  
    }  
}
```

### **Entity Framework Core (SaveChanges –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏)**

```csharp
using (var transaction = dbContext.Database.BeginTransaction())  
{  
    try  
    {  
        var account1 = dbContext.Accounts.Find(1);  
        account1.Balance -= 100;  
        
        var account2 = dbContext.Accounts.Find(2);  
        account2.Balance += 100;  
        
        dbContext.SaveChanges();  
        transaction.Commit();  // ‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ–º  
    }  
    catch  
    {  
        transaction.Rollback(); // ‚ùå –û—Ç–∫–∞—Ç  
    }  
}
```

---

## **5. TransactionScope (—É–¥–æ–±–Ω—ã–π —Å–ø–æ—Å–æ–± –≤ C#)**

üìå –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–ø—Ä–∞–≤–ª—è–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–µ–π, **–≤–∫–ª—é—á–∞—è –≤–ª–æ–∂–µ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏**.

```csharp
using (var scope = new TransactionScope())  
{  
    using (var dbContext1 = new AppDbContext())  
    {  
        dbContext1.Customers.Add(new Customer { Name = "John Doe" });  
        dbContext1.SaveChanges();  
    }  
    
    using (var dbContext2 = new AppDbContext())  
    {  
        dbContext2.Orders.Add(new Order { Amount = 100 });  
        dbContext2.SaveChanges();  
    }  
    
    scope.Complete(); // ‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é  
}
```

üìå **–ï—Å–ª–∏ `scope.Complete()` –Ω–µ –≤—ã–∑–≤–∞–Ω ‚Äì —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –æ—Ç–∫–∞—Ç—ã–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.**

---

## **6. –ü–ª—é—Å—ã –∏ –º–∏–Ω—É—Å—ã —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π**

‚úÖ **–ü–ª—é—Å—ã:**  
‚úî **–ì–∞—Ä–∞–Ω—Ç–∏—è —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö**.  
‚úî **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç–∫–∞—Ç –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö**.  
‚úî **–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ–±—ä–µ–¥–∏–Ω—è—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ SQL-–∑–∞–ø—Ä–æ—Å–æ–≤**.

‚ùå **–ú–∏–Ω—É—Å—ã:**  
‚ùå **–£–≤–µ–ª–∏—á–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ –ë–î** (–¥–æ–ª—å—à–µ —É–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏).  
‚ùå **–ú–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ `Deadlock`** (–µ—Å–ª–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è —Å–ª–∏—à–∫–æ–º –≥–ª–æ–±–∞–ª—å–Ω–∞—è).  
‚ùå **–ó–∞–º–µ–¥–ª–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã** (–æ—Å–æ–±–µ–Ω–Ω–æ –Ω–∞ `Serializable` —É—Ä–æ–≤–Ω–µ).

---

## **7. –î–µ–¥–ª–æ–∫–∏ (Deadlocks)**

**–î–µ–¥–ª–æ–∫ (–≤–∑–∞–∏–º–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞)** ‚Äì —ç—Ç–æ —Å–∏—Ç—É–∞—Ü–∏—è, –∫–æ–≥–¥–∞ –¥–≤–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∂–¥—É—Ç –¥—Ä—É–≥ –¥—Ä—É–≥–∞, –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–≤ –Ω—É–∂–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã.

üìå **–ü—Ä–∏–º–µ—Ä –¥–µ–¥–ª–æ–∫–∞:**  
üîπ –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è 1 –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª–∞ `TableA`, –ø–æ—Ç–æ–º —Ö–æ—á–µ—Ç `TableB`.  
üîπ –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è 2 –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª–∞ `TableB`, –ø–æ—Ç–æ–º —Ö–æ—á–µ—Ç `TableA`.

–û–Ω–∏ –∂–¥—É—Ç –¥—Ä—É–≥ –¥—Ä—É–≥–∞ –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ!

### **–ö–∞–∫ –∏–∑–±–µ–∂–∞—Ç—å –¥–µ–¥–ª–æ–∫–æ–≤?**

üîπ **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `NOLOCK` –¥–ª—è —á—Ç–µ–Ω–∏—è (–µ—Å–ª–∏ –¥–æ–ø—É—Å—Ç–∏–º–æ)**

```sql
SELECT * FROM Orders WITH (NOLOCK);
```

üîπ **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `ROWLOCK` –∏ `UPDLOCK` –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π**

```sql
UPDATE Orders WITH (ROWLOCK, UPDLOCK) SET Amount = 200 WHERE Id = 1;
```

üîπ **–ë–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å —Ä–µ—Å—É—Ä—Å—ã –≤ –æ–¥–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ**  
–ï—Å–ª–∏ `Transaction A` —Å–Ω–∞—á–∞–ª–∞ –±–ª–æ–∫–∏—Ä—É–µ—Ç `TableA`, `Transaction B` –¥–æ–ª–∂–Ω–∞ –¥–µ–ª–∞—Ç—å —Ç–æ –∂–µ —Å–∞–º–æ–µ.

üîπ **–û–≥—Ä–∞–Ω–∏—á–∏–≤–∞—Ç—å –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏**

```sql
SET LOCK_TIMEOUT 5000; -- –ñ–¥–∞—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ 5 —Å–µ–∫—É–Ω–¥, –∑–∞—Ç–µ–º –≤—ã–π—Ç–∏
```

üîπ **–ò–∑–±–µ–≥–∞—Ç—å —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π**  
–ß–µ–º –¥–æ–ª—å—à–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è, —Ç–µ–º –≤—ã—à–µ —à–∞–Ω—Å –¥–µ–¥–ª–æ–∫–∞.

üîπ **–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ –±–æ–ª–µ–µ –Ω–∏–∑–∫–∏–π —É—Ä–æ–≤–µ–Ω—å –∏–∑–æ–ª—è—Ü–∏–∏**  
–ù–∞–ø—Ä–∏–º–µ—Ä, `READ COMMITTED` –≤–º–µ—Å—Ç–æ `SERIALIZABLE`.

---

## **–í—ã–≤–æ–¥**

üìå **–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤–∞–∂–Ω—ã –¥–ª—è —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö**, –Ω–æ **–Ω—É–∂–Ω–æ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏**.  
üìå **TransactionScope —É–¥–æ–±–µ–Ω, –Ω–æ –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –≥–ª–æ–±–∞–ª—å–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏**.  
üìå **Deadlock ‚Äì –≥–ª–∞–≤–Ω–∞—è —É–≥—Ä–æ–∑–∞** –ø—Ä–∏ –¥–æ–ª–≥–∏—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è—Ö, –µ—ë –º–æ–∂–Ω–æ –º–∏–Ω–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏—è–º–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞–º–∏.

---