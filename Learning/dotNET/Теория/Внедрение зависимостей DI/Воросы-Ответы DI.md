#### 1. **Что такое Dependency Injection (DI)?**

**Ответ:**  
Dependency Injection — это паттерн проектирования, который позволяет управлять зависимостями между объектами путем передачи их извне, а не создания внутри объекта. Это способствует уменьшению связности (loose coupling) и улучшению тестируемости кода.

---

#### 2. **Какие преимущества дает использование DI?**

**Ответ:**

- Снижение связности компонентов.
- Улучшение тестируемости (легкость создания моков).
- Упрощение управления временем жизни объектов.
- Гибкость при замене зависимостей.
- Повышение читаемости и поддержки кода.

---

#### 3. **Какие есть способы внедрения зависимостей?**

**Ответ:**

- **Конструкторное внедрение** (рекомендуемый способ).
- **Внедрение через свойства**.
- **Внедрение через методы**.

---

#### 4. **Какие типы времени жизни объектов поддерживаются в DI-контейнере .NET?**

**Ответ:**

- **Transient**: объект создается заново при каждом запросе.
- **Scoped**: объект создается один раз на каждый HTTP-запрос.
- **Singleton**: объект создается один раз за весь жизненный цикл приложения.

---

#### 5. **Что такое IoC (Inversion of Control)? Как это связано с DI?**

**Ответ:**  
IoC — это принцип, согласно которому управление зависимостями передается внешнему контейнеру, а не решается внутри класса. DI — это конкретный способ реализации IoC.

---

#### 6. **Какие проблемы возникают при неправильной настройке DI?**

**Ответ:**

- **Циклические зависимости**.
- **Утечки памяти** из-за неправильного времени жизни объектов.
- **Сложность отладки при неправильной регистрации зависимостей**.
- **Переусложнение кода в простых проектах**.

---

#### 7. **Как реализовать DI вручную без DI-контейнера?**

**Ответ:**  
Создайте зависимости и передавайте их в конструкторы объектов вручную.

```csharp
var dependency = new Dependency();
var service = new Service(dependency);
```

---

#### 8. **Какие недостатки есть у встроенного DI-контейнера в .NET?**

**Ответ:**

- Ограниченные возможности (например, отсутствие декораторов и поддержки правил создания).
- Невозможность автоматического разрешения сложных зависимостей.
- Не такая гибкая настройка, как в сторонних DI-контейнерах (Autofac, Ninject).

---

#### 9. **Как зарегистрировать фабрику для создания объектов в DI-контейнере?**

**Ответ:**  
Используйте лямбда-функцию при регистрации:

```csharp
services.AddTransient<IMyService>(provider => new MyService(provider.GetService<IDependency>()));
```

---

#### 10. **Что такое Service Locator? Чем он отличается от DI?**

**Ответ:**  
Service Locator — это анти-паттерн, который предполагает явный запрос зависимостей из глобального реестра. В отличие от DI, он увеличивает связность компонентов и затрудняет тестирование.

---

#### 11. **Как обработать циклические зависимости в DI?**

**Ответ:**

- Убедиться, что архитектура позволяет избежать циклических ссылок.
- Использовать внедрение через свойства.
- Разделить зависимости на более мелкие сервисы.

---

#### 12. **Можно ли использовать DI в Middleware?**

**Ответ:**  
Да, зависимости можно внедрить в Middleware через параметры конструктора:

```csharp
public class MyMiddleware
{
    private readonly IMyService _service;

    public MyMiddleware(RequestDelegate next, IMyService service)
    {
        _service = service;
    }
}
```

---

#### 13. **Как внедрить зависимости в контроллеры ASP.NET Core?**

**Ответ:**  
Контроллеры поддерживают внедрение зависимостей через конструкторы. Зависимости автоматически разрешаются DI-контейнером.

```csharp
public class MyController : ControllerBase
{
    private readonly IMyService _service;

    public MyController(IMyService service)
    {
        _service = service;
    }
}
```

---

#### 14. **Как зарегистрировать зависимости для различных окружений (Development/Production)?**

**Ответ:**  
Используйте условия в зависимости от текущего окружения:

```csharp
if (builder.Environment.IsDevelopment())
{
    services.AddSingleton<IMyService, DevMyService>();
}
else
{
    services.AddSingleton<IMyService, ProdMyService>();
}
```

---

#### 15. **Можно ли зарегистрировать один и тот же интерфейс с разными реализациями?**

**Ответ:**  
Да, можно зарегистрировать разные реализации с использованием именованных или условных сервисов.

```csharp
services.AddSingleton<IMyService, MyService1>();
services.AddSingleton<IMyService, MyService2>();
```

---

#### 16. **Как протестировать класс с зависимостями, используя DI?**

**Ответ:**  
Используйте мок-фреймворки, такие как Moq, для подмены зависимостей:

```csharp
var mockService = new Mock<IMyService>();
var controller = new MyController(mockService.Object);
```

---

#### 17. **Как внедрить конфигурацию из `appsettings.json` через DI?**

**Ответ:**  
Используйте `IOptions<T>`:

```csharp
services.Configure<MyConfig>(configuration.GetSection("MyConfig"));
```

---

#### 18. **Как зарегистрировать и использовать реализацию по умолчанию и альтернативу?**

**Ответ:**  
Используйте условные проверки при разрешении зависимости.

```csharp
services.AddSingleton<IMyService, MyDefaultService>();
services.AddSingleton<IMyService, MyAlternativeService>("Alternative");
```

---

#### 19. **Можно ли использовать DI для реализации паттерна Factory?**

**Ответ:**  
Да, фабрики можно зарегистрировать в DI-контейнере через делегаты:

```csharp
services.AddTransient<IMyFactory, MyFactory>();
```

---

#### 20. **Что произойдет, если Singleton-зависимость содержит Scoped-зависимость?**

**Ответ:**  
Scoped-зависимость будет повышена до Singleton-жизненного цикла, что может привести к нежелательному поведению и проблемам с многопоточностью.