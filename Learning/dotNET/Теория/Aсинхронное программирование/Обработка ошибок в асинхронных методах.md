```C#
try
{
    await PrintAsync("Hello METANIT.COM");
    await PrintAsync("Hi");
}
catch (Exception ex)
{
    Console.WriteLine(ex.Message);
}
 
async Task PrintAsync(string message)
{
    // если длина строки меньше 3 символов, генерируем исключение
    if (message.Length < 3)
        throw new ArgumentException($"Invalid string length: {message.Length}");
    await Task.Delay(100);     // имитация продолжительной операции
    Console.WriteLine(message);
}
```

**Следует учитывать, что если асинхронный метод имеет тип void, то в этом случае исключение во вне не передается, соответственно мы не сможем обработать исключение при вызове метода.**

```C#
try
{
    PrintAsync("Hello METANIT.COM");
    PrintAsync("Hi");       // здесь программа сгенерирует исключение и аварийно остановится
    await Task.Delay(1000); // ждем завершения задач
}
catch (Exception ex)    // исключение НЕ будет обработано
{
    Console.WriteLine(ex.Message);
}
 
async void PrintAsync(string message)
{
    // если длина строки меньше 3 символов, генерируем исключение
    if (message.Length < 3)
        throw new ArgumentException($"Invalid string length: {message.Length}");
    await Task.Delay(100);     // имитация продолжительной операции
    Console.WriteLine(message);
}
```

### Исследование исключения

При возникновении ошибки у объекта Task, представляющего асинхронную задачу, в которой произошла ошибка, свойство **IsFaulted** имеет значение `true`. Кроме того, свойство `Exception` объекта Task содержит всю информацию об ошибке.

```C#
var task = PrintAsync("Hi");
try
{
    await task;
}
catch
{
    Console.WriteLine(task.Exception?.InnerException?.Message); // Invalid string length: 2
    Console.WriteLine($"IsFaulted: {task.IsFaulted}");  // IsFaulted: True
    Console.WriteLine($"Status: {task.Status}");        // Status: Faulted
}
 
async Task PrintAsync(string message)
{
    // если длина строки меньше 3 символов, генерируем исключение
    if (message.Length < 3)
        throw new ArgumentException($"Invalid string length: {message.Length}");
    await Task.Delay(1000);     // имитация продолжительной операции
    Console.WriteLine(message);
}
```

### Обработка нескольких исключений. WhenAll
```C#
// определяем и запускаем задачи
var task1 = PrintAsync("H");
var task2 = PrintAsync("Hi");
var allTasks = Task.WhenAll(task1, task2);
try
{
    await allTasks;
}
catch (Exception ex)
{
    Console.WriteLine($"Exception: {ex.Message}");
    Console.WriteLine($"IsFaulted: {allTasks.IsFaulted}");
    if(allTasks.Exception is not null)
    {
        foreach (var exception in allTasks.Exception.InnerExceptions)
        {
            Console.WriteLine($"InnerException: {exception.Message}");
        }
    }
}
 
async Task PrintAsync(string message)
{
    // если длина строки меньше 3 символов, генерируем исключение
    if (message.Length < 3)
        throw new ArgumentException($"Invalid string: {message}");
    await Task.Delay(1000);     // имитация продолжительной операции
    Console.WriteLine(message);
}
```