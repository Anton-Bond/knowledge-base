#### **1. В чем разница между аутентификацией и авторизацией?**

**Аутентификация** – это проверка личности пользователя (кто он есть).  
**Авторизация** – это проверка прав доступа (что он может делать).

---

#### **2. Какие методы аутентификации доступны в .NET?**

- **Форм-based authentication** (логин/пароль).
- **Windows Authentication** (через Active Directory).
- **JWT (JSON Web Token)**.
- **OAuth 2.0/OpenID Connect**.
- **Certificate Authentication**.
- **API Key authentication**.

---

#### **Что такое ASP.NET Core Identity?**

**ASP.NET Core Identity** – это фреймворк для управления пользователями в .NET. Он включает:
 - **UserManager** – управление пользователями.
 - **SignInManager** – управление входом.
 - **RoleManager** – управление ролями.
 - **PasswordHasher** – хеширование паролей.
 - **TokenProvider** – генерация токенов для подтверждения email, сброса пароля и т. д.

---

#### **3. Как работает Cookie-based аутентификация?**

Сервер создает куки после успешного входа пользователя и отправляет их в браузер. При каждом запросе браузер отправляет куки, позволяя серверу идентифицировать пользователя.

---

#### **4. Что такое JWT?**

JSON Web Token (JWT) – это компактный и безопасный формат передачи информации между клиентом и сервером. Он состоит из **Header, Payload и Signature**.

---

#### **5. Чем JWT лучше Cookie-based аутентификации?**

JWT:  
✅ Безопасен при использовании HTTPS.  
✅ Не требует хранения состояния на сервере (stateless).  
✅ Можно использовать в мобильных и SPA-приложениях.

---

#### **6. Что содержится в Payload JWT?**

Payload (полезная нагрузка) содержит данные о пользователе, такие как `sub` (subject), `name`, `roles` и срок действия токена (`exp`).

---

#### **7. Как работает OAuth 2.0?**

OAuth 2.0 – это протокол авторизации, где сторонние приложения получают доступ к ресурсам пользователя без передачи его пароля, используя Access Token.

---

#### **8. В чем разница между OAuth 2.0 и OpenID Connect?**

OAuth 2.0 – только про **авторизацию**.  
OpenID Connect – расширение OAuth 2.0, включающее **аутентификацию**.

---

#### **9. Какие есть Grant Types в OAuth 2.0?**

- **Authorization Code** – безопасный для веб-приложений.
- **Implicit** (устарел) – для SPA, но небезопасен.
- **Client Credentials** – для взаимодействия сервер-сервер.
- **Resource Owner Password Credentials** (устарел) – ввод логина/пароля.
- **Device Code** – для устройств без клавиатуры (TV).

---

#### **10. Что такое Access Token и Refresh Token?**

- **Access Token** – используется для доступа к API, короткоживущий.
- **Refresh Token** – обновляет Access Token без повторного входа.

---

#### **11. Что такое IdentityServer?**

IdentityServer – это фреймворк для реализации аутентификации и авторизации в .NET с поддержкой OAuth 2.0 и OpenID Connect.

---

#### **12. Как настроить аутентификацию через JWT в ASP.NET Core?**

1. Добавить `JwtBearerAuthentication` в `Program.cs`:
    
    ```csharp
    builder.Services.AddAuthentication(JwtBearerDefaults.AuthenticationScheme)
        .AddJwtBearer(options =>
        {
            options.TokenValidationParameters = new TokenValidationParameters
            {
                ValidateIssuer = true,
                ValidateAudience = true,
                ValidateLifetime = true,
                ValidateIssuerSigningKey = true,
                ValidIssuer = "issuer",
                ValidAudience = "audience",
                IssuerSigningKey = new SymmetricSecurityKey(Encoding.UTF8.GetBytes("your_secret_key"))
            };
        });
    ```
    
2. Добавить `app.UseAuthentication();` перед `app.UseAuthorization();`.

---

#### **13. Как защитить API с помощью JWT?**

Использовать атрибут `[Authorize]`:

```csharp
[Authorize]
[ApiController]
[Route("api/secure")]
public class SecureController : ControllerBase
{
    public IActionResult GetSecureData() => Ok("Это защищенные данные");
}
```

---

#### **14. Как ограничить доступ на основе ролей?**

```csharp
[Authorize(Roles = "Admin")]
```

---

#### **15. Как ограничить доступ на основе политик?**

```csharp
[Authorize(Policy = "CanEditResource")]
```

Определить политику в `Program.cs`:

```csharp
builder.Services.AddAuthorization(options =>
{
    options.AddPolicy("CanEditResource", policy =>
        policy.RequireClaim("EditPermission", "true"));
});
```

---

#### **16. Что такое Claims?**

Claims – это набор атрибутов пользователя (например, email, role, permission).

---

#### **17. Чем `Claims` отличаются от `Roles`?**

**Roles** – это более обобщенные категории (`Admin`, `User`).  
**Claims** – более детальные (`CanEditPost`, `CanDeleteComment`).

---

#### **18. Как использовать Claims в ASP.NET Core?**

```csharp
[Authorize(Policy = "CanEditResource")]
public IActionResult Edit()
{
    return Ok("Можно редактировать");
}
```

---

#### **19. Что такое CORS и как он влияет на аутентификацию?**

CORS (Cross-Origin Resource Sharing) запрещает запросы с других доменов. Если не настроен, браузер блокирует запросы к API, защищенному JWT.

---

#### **20. Как включить CORS в ASP.NET Core?**

```csharp
builder.Services.AddCors(options =>
{
    options.AddPolicy("AllowAll",
        policy => policy.AllowAnyOrigin().AllowAnyMethod().AllowAnyHeader());
});
app.UseCors("AllowAll");
```

---

#### **21. Как защитить API от CSRF-атак?**

Использовать **anti-forgery токены** или отказаться от Cookie-based аутентификации в пользу JWT.

---

#### **22. Чем `IIdentity` отличается от `IPrincipal`?**

- `IIdentity` – хранит информацию о пользователе (логин, аутентифицирован ли).
- `IPrincipal` – хранит `IIdentity` и проверяет роли (`IsInRole`).

---

#### **23. Как реализовать двухфакторную аутентификацию (2FA) в .NET?**

Использовать **ASP.NET Identity + OTP (Google Authenticator, SMS, Email)**.

---

#### **24. Как работает Single Sign-On (SSO)?**

SSO позволяет пользователю входить один раз и получать доступ к разным системам без повторной аутентификации.

---

#### **25. Как отключить пользователя (logout)?**

В Cookie-based:

```csharp
await HttpContext.SignOutAsync(CookieAuthenticationDefaults.AuthenticationScheme);
```

В JWT: просто удалить токен на клиенте.

---

#### **26. Как бороться с атакой повторного воспроизведения (Replay Attack)?**

Использовать `nonce` или `jti` (уникальный идентификатор токена).

---

#### **27. Как защитить API от brute force атак?**

Использовать **Rate Limiting** с `AspNetCoreRateLimit`.

---

#### **28. Как реализовать RBAC (Role-Based Access Control)?**

Использовать роли в ASP.NET Identity.

---

#### **29. Как хранить пароли безопасно?**

Использовать `PasswordHasher<TUser>` в ASP.NET Identity.

---

#### **30. Как включить аудит входов пользователей?**

Использовать `SignInManager` и логировать события аутентификации.

---
