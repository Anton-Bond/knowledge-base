### **Определения понятий по каждому виду отношений между сущностями в Entity Framework Core**

#### **1. Один к одному (One-to-One, 1:1)**

**Определение:**  
Отношение **"один к одному"** означает, что каждая запись в одной таблице связана **только с одной** записью в другой таблице.

**Пример:**

- Один пользователь (`User`) имеет один адрес (`Address`).
- Каждому пользователю соответствует ровно один адрес, и наоборот.

**Как реализуется в EF Core?**

- Используется **внешний ключ (Foreign Key)**.
- Один из связанных объектов является **основным (Principal Entity)**, а другой — **зависимым (Dependent Entity)**.
- Можно использовать **аннотации данных** (`[ForeignKey]`) или **Fluent API** (`HasOne().WithOne()`).

**Пример кода:**

```csharp
public class User
{
    public int Id { get; set; }
    public string Name { get; set; }
    public Address Address { get; set; }
}

public class Address
{
    public int Id { get; set; }
    public string Street { get; set; }
    public int UserId { get; set; }
    public User User { get; set; }
}
```

```csharp
modelBuilder.Entity<User>()
    .HasOne(u => u.Address)
    .WithOne(a => a.User)
    .HasForeignKey<Address>(a => a.UserId);
```

---

#### **2. Один ко многим (One-to-Many, 1:M)**

**Определение:**  
Отношение **"один ко многим"** означает, что **одна** запись в одной таблице может быть связана с **несколькими** записями в другой таблице.

**Пример:**

- Один автор (`Author`) может написать **несколько книг** (`Book`).
- Каждая книга связана только с одним автором.

**Как реализуется в EF Core?**

- В основной сущности (Principal Entity) есть **коллекция зависимых сущностей**.
- В зависимой сущности (Dependent Entity) есть **внешний ключ**.
- Используется **Fluent API** (`HasOne().WithMany()`).

**Пример кода:**

```csharp
public class Author
{
    public int Id { get; set; }
    public string Name { get; set; }
    public List<Book> Books { get; set; }
}

public class Book
{
    public int Id { get; set; }
    public string Title { get; set; }
    public int AuthorId { get; set; }
    public Author Author { get; set; }
}
```

```csharp
modelBuilder.Entity<Book>()
    .HasOne(b => b.Author)
    .WithMany(a => a.Books)
    .HasForeignKey(b => b.AuthorId);
```

---

#### **3. Многие ко многим (Many-to-Many, M:M)**

**Определение:**  
Отношение **"многие ко многим"** означает, что одна запись в первой таблице может быть связана с **несколькими** записями во второй таблице, и наоборот.

**Пример:**

- Один студент (`Student`) может посещать **несколько курсов** (`Course`).
- Один курс может быть записан **несколькими студентами**.

**Как реализуется в EF Core?**

##### **До EF Core 5.0**

- Требовалась промежуточная таблица (`StudentCourse`).
- Использовалась **конфигурация через Fluent API**.

##### **С EF Core 5.0+**

- Можно создавать **напрямую без промежуточной сущности** с помощью `HasMany().WithMany()`.

**Пример кода (EF Core 5+):**

```csharp
public class Student
{
    public int Id { get; set; }
    public string Name { get; set; }
    public List<Course> Courses { get; set; }
}

public class Course
{
    public int Id { get; set; }
    public string Title { get; set; }
    public List<Student> Students { get; set; }
}
```

```csharp
modelBuilder.Entity<Student>()
    .HasMany(s => s.Courses)
    .WithMany(c => c.Students)
    .UsingEntity(j => j.ToTable("StudentCourses"));
```

##### **Если нужна промежуточная сущность (до EF Core 5.0):**

```csharp
public class StudentCourse
{
    public int StudentId { get; set; }
    public Student Student { get; set; }

    public int CourseId { get; set; }
    public Course Course { get; set; }
}
```

```csharp
modelBuilder.Entity<StudentCourse>()
    .HasKey(sc => new { sc.StudentId, sc.CourseId });

modelBuilder.Entity<StudentCourse>()
    .HasOne(sc => sc.Student)
    .WithMany(s => s.StudentCourses)
    .HasForeignKey(sc => sc.StudentId);

modelBuilder.Entity<StudentCourse>()
    .HasOne(sc => sc.Course)
    .WithMany(c => c.StudentCourses)
    .HasForeignKey(sc => sc.CourseId);
```

---

### **Краткое сравнение отношений в EF Core**

|Тип связи|Описание|Пример|
|---|---|---|
|**Один к одному (1:1)**|Одна запись в первой таблице соответствует одной записи во второй таблице|Один пользователь – один адрес|
|**Один ко многим (1:M)**|Одна запись в первой таблице может быть связана с несколькими записями во второй таблице|Один автор – несколько книг|
|**Многие ко многим (M:M)**|Одна запись в первой таблице связана с несколькими записями во второй таблице, и наоборот|Один студент – несколько курсов|
