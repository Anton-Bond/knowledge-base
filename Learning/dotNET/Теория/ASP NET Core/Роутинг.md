Роутинг в ASP.NET Core определяет, как запросы HTTP связываются с конкретными обработчиками (например, контроллерами, действиями или Razor Pages).

---

#### 1. **Что такое роутинг?**

Роутинг — это система, которая анализирует URL запроса и сопоставляет его с зарегистрированными маршрутами.

- **URL**: `{controller}/{action}/{id?}`
- **Маршрут**: Набор шаблонов и правил для обработки запросов.

Пример:

- Запрос: `https://example.com/Home/Index/1`.
- Роутинг: Определяет, что контроллер — `Home`, метод действия — `Index`, а `id = 1`.

---

#### 2. **Типы маршрутов**

1. **Шаблонные маршруты (Convention-based routing)**
    
    - Используются для стандартного формирования URL.
    - Пример:
        
        ```csharp
        app.UseEndpoints(endpoints =>
        {
            endpoints.MapControllerRoute(
                name: "default",
                pattern: "{controller=Home}/{action=Index}/{id?}");
        });
        ```
        
2. **Атрибутные маршруты (Attribute-based routing)**
    
    - Маршруты указываются в атрибутах над методами и контроллерами.
    - Пример:
        
        ```csharp
        [Route("products/{id:int}")]
        public IActionResult GetProduct(int id)
        {
            return View();
        }
        ```
        
3. **Кастомные маршруты**
    
    - Маршруты, заданные вручную для специфических случаев.
    - Пример:
        
        ```csharp
        endpoints.MapGet("about", async context =>
        {
            await context.Response.WriteAsync("About Page");
        });
        ```
        

---

#### 3. **Функции MapControllerRoute**

**MapControllerRoute** — это метод, который связывает шаблон маршрута с контроллером.

**Пример:**

```csharp
endpoints.MapControllerRoute(
    name: "default",
    pattern: "{controller=Home}/{action=Index}/{id?}");
```

- **`name`**: Имя маршрута (используется редко).
- **`pattern`**: Шаблон URL.
- **`defaults`**: Параметры по умолчанию (например, `controller=Home`).

---

#### 4. **Порядок маршрутов**

- Маршруты обрабатываются сверху вниз.
- Самый специфичный маршрут должен быть первым.

Пример:

```csharp
endpoints.MapControllerRoute(
    name: "specific",
    pattern: "admin/dashboard",
    defaults: new { controller = "Admin", action = "Dashboard" });

endpoints.MapControllerRoute(
    name: "default",
    pattern: "{controller=Home}/{action=Index}/{id?}");
```

Запрос `/admin/dashboard` будет обработан первым маршрутом, а `/home/index` — вторым.

---

#### 5. **Атрибуты маршрутизации**

1. **[Route]**  
    Определяет маршрут для метода или контроллера.
    
    ```csharp
    [Route("products/{id:int}")]
    public IActionResult GetProduct(int id) { }
    ```
    
2. **[HttpGet], [HttpPost], [HttpPut], [HttpDelete]**  
    Ограничивают маршрут определенными HTTP-методами.
    
    ```csharp
    [HttpGet("products/{id}")]
    public IActionResult GetProduct(int id) { }
    ```
    
3. **[FromRoute]**  
    Извлекает параметры из маршрута.
    
    ```csharp
    public IActionResult GetProduct([FromRoute] int id) { }
    ```
    
4. **[FromQuery], [FromBody], [FromForm]**  
    Указывают источник данных (например, из строки запроса, тела HTTP, формы).
    

---

#### 6. **Гибкость маршрутизации**

1. **Ограничения параметров**  
    Указывают, какие значения допустимы в параметре.  
    Пример:
    
    ```csharp
    [Route("products/{id:int}")] // Только целое число
    [Route("products/{name:alpha}")] // Только буквы
    ```
    
2. **Параметры по умолчанию**  
    Если параметр не указан, используется значение по умолчанию.
    
    ```csharp
    [Route("products/{id:int=1}")]
    ```
    
3. **Опциональные параметры**  
    Параметры, которые могут быть пропущены.
    
    ```csharp
    [Route("products/{id?}")]
    ```
    

---
